<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Post</title>
</head>
<body>
<h1>Booklog</h1>
<h3>ê¸€ ê°œë³„ ì¡°íšŒ</h3>
    <div>
        <div th:for="postTitle">ê²Œì‹œê¸€ ì œëª© : <span th:text="${post_.postTitle}"></span></div>
        <div th:for="postAt">ì‘ì„±ì¼ : <span th:text="${post_.postAt}"></span></div>
        <div th:for="bookTitle">ì±… ì œëª© : <span th:text="${post_.bookTitle}"></span></div>
        <div th:for="bookWriter">ì‘ê°€ : <span th:text="${post_.bookWriter}"></span></div>
        <div th:for="readStart">ì½ê¸° ì‹œì‘í•œ ë‚  : <span th:text="${post_.readStart}"></span></div>
        <div th:for="readEnd">ë‹¤ ì½ì€ ë‚  : <span th:text="${post_.readEnd}"></span></div>
        <div th:for="rating">í‰ì  : <span th:text="${post_.rating}"></span></div>
        <div th:for="content">í›„ê¸° : <span th:text="${post_.content}"></span></div>
    </div>
    <button th:if="${userId == post_.postWriterId}" th:onclick="|location.href='@{/posts/update/{id}(id=${post_.id})}'|" type="button">ìˆ˜ì •í•˜ê¸°</button>
    <button th:onclick="|location.href='@{/home}'|" type="button">ëª©ë¡ë³´ê¸°</button>

    <table>
        <tr>
            <td href="#" th:if="${post_.isLike == true}" th:onclick="|javascript:cancel(${post_.id}, ${post_.likeId})|">â™¥</td>
            <td href="#" th:onclick="|javascript:like(${post_.id})|" th:unless="${post_.isLike == true}">â™¡</td>
            <td th:text="${post_.likesCnt}" type="text"></td>
            <td th:text="|ğŸ’¬ ${post_.commentsCnt}|" type="text"></td>
        </tr>
    </table>
    <hr/>
    <table border="1" th:if="${!#lists.isEmpty(post_.comments)}">
        <thead>
        <tr>
            <th>#</th>
            <th>ë‹‰ë„¤ì„</th>
            <th>ëŒ“ê¸€</th>
            <th>ëŒ“ê¸€ ë‹¨ ì‹œê°„</th>
            <th>ë©”ë‰´</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="comment : ${post_.comments}">
            <td th:text="${comment.id}"></td>
            <td th:text="${comment.nickname}"></td>
            <td th:text="${comment.content}"></td>
            <td th:text="${comment.commentAt}"></td>
            <td th:if="${userId == comment.userId}" th:onclick="|javascript:deleteComment(${comment.id})|" type="button">ì‚­ì œ</td>
        </tr>
        </tbody>
    </table>
    <form method="post" th:action="@{/comments}" th:object="${commentForm}">
        <input th:field="*{content}" type="text">
        <input id="postId" name="postId" th:value="${post_.id}" type="hidden">
        <input id="userId" name="userId" th:value="${userId}" type="hidden">
        <button type="submit">ëŒ“ê¸€ë‹¬ê¸°</button>
    </form>
</body>
</html>
<script>
    function like(postId) {
        var form = document.createElement("form");
        form.setAttribute("method", "post");
        form.setAttribute("action", "/posts/" + postId + "/likes");
        document.body.appendChild(form);

        form.submit();
    }

    function cancel(id, likeId) {
        var form = document.createElement("form");

        form.setAttribute("method", "post");
        form.setAttribute("action", "/posts/" + id + "/likes");

        // set method to delete
        var m = document.createElement('input');
        m.setAttribute("type", "hidden");
        m.setAttribute("name", "_method");
        m.setAttribute("value", "delete");

        // create element (input)
        var input1 = document.createElement('input');
        // set attribute (input)
        input1.setAttribute("type", "hidden")
        input1.setAttribute("name", "likeId")
        input1.setAttribute("value", likeId)

        // append input (to form)
        form.appendChild(m);
        form.appendChild(input1);

        // append form (to body)
        document.body.appendChild(form);

        form.submit();
    }

    function deleteComment(id) {

        var form = document.createElement("form");

        form.setAttribute("method", "post");
        form.setAttribute("action", "/comments/" + id);

        // set method to delete
        var m = document.createElement('input');
        m.setAttribute("type", "hidden");
        m.setAttribute("name", "_method");
        m.setAttribute("value", "delete");

        form.appendChild(m);

        document.body.appendChild(form);

        form.submit();
    }
</script>