<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Post</title>
</head>
<body>
    <h1>Booklog</h1>
    <h3>ê¸€ ìˆ˜ì •í•˜ê¸°</h3>
    <form method="post" th:action th:object="${postForm}">
        <input name="_method" type="hidden" value="put"/>
        <label th:for="postTitle">ê²Œì‹œê¸€ ì œëª© : </label>
        <input id="postTitle" name="postTitle" placeholder="ê²Œì‹œê¸€ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" th:value="${post_.postTitle}" type="text"/>
        <label th:for="bookTitle">ì±… ì œëª© : </label>
        <input id="bookTitle" name="bookTitle" placeholder="ì±… ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" th:value="${post_.bookTitle}" type="text"/>
        <label th:for="bookWriter">ì‘ê°€ : </label>
        <input id="bookWriter" name="bookWriter" placeholder="ì‘ê°€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" th:value="${post_.bookWriter}" type="text"/>
        <label th:for="readStart">ì½ê¸° ì‹œì‘í•œ ë‚  : </label>
        <input id="readStart" name="readStart" th:value="${post_.readStart}" type="date"/>
        <label th:for="readEnd">ë‹¤ ì½ì€ ë‚  : </label>
        <input id="readEnd" name="readEnd" th:value="${post_.readEnd}" type="date"/>
        <label th:for="rating">í‰ì  : </label>
        <input id="rating" name="rating" placeholder="í‰ì ì„ ì…ë ¥í•˜ì„¸ìš”" th:value="${post_.rating}" type="text"/>
        <label th:for="content">í›„ê¸° : </label>
        <input id="content" name="content" placeholder="í›„ê¸°ë¥¼ ì…ë ¥í•˜ì„¸ìš”" th:value="${post_.content}" type="text"/>
        <input id="postAt" name="postAt" th:value="${post_.postAt}" type="hidden">
        <button type="submit">ì €ì¥í•˜ê¸°</button>
        <button th:onclick="|location.href='@{/home}'|" type="button">ëª©ë¡ë³´ê¸°</button>
    </form>
    <table>
        <tr>
            <td href="#" th:if="${post_.isLike == true}" th:onclick="|javascript:cancel(${post_.id}, ${post_.likeId})|">â™¥</td>
            <td href="#" th:onclick="|javascript:like(${post_.id})|" th:unless="${post_.isLike == true}">â™¡</td>
            <td th:text="${post_.likesCnt}" type="text"></td>
            <td th:text="|ğŸ’¬ ${post_.commentsCnt}|" type="text"></td>
        </tr>
    </table>
    <table border="1">
        <thead>
        <tr>
            <th>#</th>
            <th>ë‹‰ë„¤ì„</th>
            <th>ëŒ“ê¸€</th>
            <th>ëŒ“ê¸€ ë‹¨ ì‹œê°„</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="comment : ${comments}">
            <td th:text="${comment.id}"></td>
            <td th:text="${comment.nickname}"></td>
            <td th:text="${comment.content}"></td>
            <td th:text="${comment.commentAt}"></td>
            <td th:onclick="|javascript:deleteComment(${comment.id})|" type="button">ì‚­ì œ</td>
        </tr>
        </tbody>
    </table>
    <form method="post" th:action="@{/comments}" th:object="${commentForm}">
        <input th:field="*{content}" type="text">
        <input id="postId" name="postId" th:value="${post_.id}" type="hidden">
        <button type="submit">ëŒ“ê¸€ë‹¬ê¸°</button>
    </form>
</body>
<script>
    function like(id) {
        var form = document.createElement("form");
        form.setAttribute("method", "post");
        form.setAttribute("action", "/posts/" + id + "/likes");
        document.body.appendChild(form);
        form.submit();
    }

    function cancel(id, likeId) {
        var form = document.createElement("form");

        form.setAttribute("method", "post");
        form.setAttribute("action", "/posts/" + id + "/likes");

        // set method to delete
        var m = document.createElement('input');
        m.setAttribute("type", "hidden");
        m.setAttribute("name", "_method");
        m.setAttribute("value", "delete");

        // create element (input)
        var input1 = document.createElement('input');
        // set attribute (input)
        input1.setAttribute("type", "hidden")
        input1.setAttribute("name", "likeId")
        input1.setAttribute("value", likeId)

        // append input (to form)
        form.appendChild(m);
        form.appendChild(input1);

        // append form (to body)
        document.body.appendChild(form);

        form.submit();
    }

    function deleteComment(id) {

        var form = document.createElement("form");

        form.setAttribute("method", "post");
        form.setAttribute("action", "/comments/" + id);

        // set method to delete
        var m = document.createElement('input');
        m.setAttribute("type", "hidden");
        m.setAttribute("name", "_method");
        m.setAttribute("value", "delete");

        form.appendChild(m);

        document.body.appendChild(form);

        form.submit();
    }
</script>
</html>